<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0f1c3f">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="FPC Atleta">
    
    <link rel="icon" type="image/png" href="logo-fpc.png">
    <link rel="apple-touch-icon" href="logo-fpc.png">
    
    <title>FPC - Sistema Atleta</title>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <style>
        :root {
            --fpc-blue: #0f1c3f;
            --fpc-yellow: #fdd000;
            --fpc-red: #e30613;
            --fpc-green: #009640;
            --bg-dark: #0a0e17;
            --glass: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --text: #ffffff;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Montserrat', sans-serif;
            background-color: var(--fpc-blue);
            color: var(--text);
            margin: 0; padding: 0; height: 100vh;
            overflow: hidden;
            display: flex; justify-content: center;
        }

        /* TELA DE ABERTURA (Splash) */
        #splash-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--fpc-blue); z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            transition: opacity 0.5s ease-out;
        }
        .splash-logo { width: 120px; animation: pulse 1.5s infinite; }

        /* CONTAINER APP */
        .container {
            width: 100%; height: 100%;
            background: linear-gradient(160deg, var(--fpc-blue) 0%, #000 100%);
            overflow-y: auto; padding: 20px; padding-bottom: 80px;
        }
        @media (min-width: 600px) {
            .container { max-width: 400px; height: 90vh; margin-top: 5vh; border-radius: 20px; border: 1px solid var(--glass-border); }
        }

        /* HEADER */
        .app-header { text-align: center; margin: 30px 0 20px 0; }
        .logo-area {
            width: 100px; height: 100px; background: white; border-radius: 50%;
            margin: 0 auto 15px; display: flex; align-items: center; justify-content: center;
            border: 4px solid var(--fpc-yellow); overflow: hidden;
        }
        .logo-area img { width: 100%; height: 100%; object-fit: cover; }
        h2 { font-weight: 800; text-transform: uppercase; margin: 0; font-size: 1.6em; }
        .subtitle { font-size: 0.7em; color: var(--fpc-yellow); letter-spacing: 1px; text-transform: uppercase; margin-top: 5px; }

        /* INPUTS & BOT√ïES */
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; margin-bottom: 5px; font-size: 0.85em; color: #ccc; margin-left: 5px; }
        .input-group input {
            width: 100%; padding: 14px; border: 1px solid var(--glass-border); border-radius: 12px;
            background: var(--glass); color: white; outline: none; font-size: 1rem;
        }
        .input-group input:focus { border-color: var(--fpc-yellow); background: rgba(255,255,255, 0.1); }

        button {
            width: 100%; padding: 16px; background: linear-gradient(90deg, var(--fpc-yellow), #e6bc00);
            border: none; color: var(--fpc-blue); font-weight: 800; border-radius: 12px;
            cursor: pointer; font-size: 1rem; margin-top: 10px; text-transform: uppercase;
        }
        
        /* BOT√ÉO DE INSTALA√á√ÉO (Destaque) */
        #install-btn {
            display: none; /* Controlado via JS */
            background: #009640; color: white; margin-bottom: 15px;
            box-shadow: 0 0 15px rgba(0, 150, 64, 0.5);
            animation: pulseBtn 2s infinite;
        }
        @keyframes pulseBtn { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }
        
        #ios-btn {
            display: none; background: rgba(255,255,255,0.1); border: 1px solid white; color: white; margin-bottom: 15px;
        }

        .link { text-align: center; margin-top: 20px; font-size: 0.9em; cursor: pointer; color: #aaa; }
        .link span { color: var(--fpc-yellow); font-weight: bold; }

        /* UTILIT√ÅRIOS */
        .view { display: none; animation: fadeIn 0.4s; padding-bottom: 50px; }
        .view.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* MENU GRID */
        .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .menu-item {
            background: rgba(255,255,255,0.05); padding: 20px 10px; border-radius: 16px;
            text-align: center; cursor: pointer; display: flex; flex-direction: column; align-items: center;
        }
        .menu-item i { font-size: 28px; margin-bottom: 10px; color: var(--fpc-yellow); }
        .menu-item p { margin: 0; font-weight: 700; font-size: 0.75rem; text-transform: uppercase; }

        .dash-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; padding-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .user-name { font-size: 1.2em; color: var(--fpc-yellow); font-weight: 800; text-transform: uppercase; }
        
        /* Modal iOS */
        #ios-modal {
            position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:999;
            display:none; align-items:flex-end;
        }
        .ios-content { background:#222; width:100%; padding:20px; border-radius:20px 20px 0 0; text-align:center; }

        /* Ticket e outros */
        #ticket-area { background: #000; border: 2px solid var(--fpc-yellow); padding: 20px; border-radius: 15px; text-align: center; margin-bottom: 20px; }
        .partner-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .partner-card { background: white; border-radius: 8px; height: 60px; display: flex; align-items: center; justify-content: center; }
        .partner-card i { color: #333; font-size: 1.5rem; }
    </style>
</head>
<body>

    <div id="splash-screen">
        <img src="logo-fpc.png" class="splash-logo">
        <h2 style="color:white; margin-top:20px;">F.P.C.</h2>
    </div>

    <div class="container" id="app-content" style="display:none;">
        
        <div id="view-login" class="view active">
            <div class="app-header">
                <div class="logo-area"><img src="logo-fpc.png"></div>
                <h2>F.P.C.</h2>
                <div class="subtitle">Federa√ß√£o Pernambucana de Ciclismo</div>
            </div>

            <button id="install-btn" onclick="installApp()">üì≤ INSTALAR APLICATIVO</button>
            <button id="ios-btn" onclick="showIOS()">üì≤ INSTALAR NO IPHONE</button>

            <div class="input-group">
                <label>CPF</label>
                <input type="text" id="login-cpf" placeholder="000.000.000-00" maxlength="14" oninput="maskCPF(this)">
            </div>
            <div class="input-group">
                <label>Senha</label>
                <input type="password" id="login-pass">
            </div>
            
            <button onclick="fazerLogin()">ENTRAR</button>
            
            <div class="link" onclick="toggleView('view-recover')">Recuperar Senha</div>
            <div class="link">N√£o √© filiado? <span onclick="toggleView('view-register')">FILIE-SE AGORA</span></div>
            <div style="text-align:center; margin-top:30px; opacity:0.5;">
                <small onclick="resetarSistema()">Limpar Dados</small>
            </div>
        </div>

        <div id="ios-modal" onclick="this.style.display='none'">
            <div class="ios-content" onclick="event.stopPropagation()">
                <h3 style="color:white;">Para Instalar no iPhone:</h3>
                <p style="color:#ccc;">1. Toque no bot√£o <strong>Compartilhar</strong> abaixo.<br>2. Selecione <strong>"Adicionar √† Tela de In√≠cio"</strong>.</p>
                <button onclick="document.getElementById('ios-modal').style.display='none'">ENTENDI</button>
            </div>
        </div>

        <div id="view-register" class="view">
            <h3 style="text-align:center; margin-bottom:20px;">Nova Filia√ß√£o</h3>
            <div class="input-group"><label>Nome</label><input type="text" id="reg-name"></div>
            <div class="input-group"><label>Nascimento</label><input type="date" id="reg-birth"></div>
            <div class="input-group"><label>Celular</label><input type="text" id="reg-phone" oninput="maskPhone(this)"></div>
            <div class="input-group"><label>CPF</label><input type="text" id="reg-cpf" oninput="maskCPF(this)"></div>
            <div class="input-group"><label>Senha</label><input type="password" id="reg-pass"></div>
            <div class="input-group"><label>Palavra Seguran√ßa</label><input type="text" id="reg-sec"></div>
            <button onclick="registrarUsuario()">CADASTRAR</button>
            <div class="link" onclick="toggleView('view-login')">Voltar</div>
        </div>

        <div id="view-dashboard" class="view">
            <div class="dash-header">
                <div><span class="user-name" id="user-name-display">Atleta</span></div>
                <i class="fas fa-sign-out-alt" onclick="logout()" style="color:var(--fpc-red); font-size:1.2em;"></i>
            </div>
            <div class="menu-grid">
                <div class="menu-item" onclick="abrirModalidade('Downhill')"><i class="fas fa-mountain"></i><p>Downhill</p></div>
                <div class="menu-item" onclick="abrirModalidade('Speed')"><i class="fas fa-tachometer-alt"></i><p>Speed</p></div>
                <div class="menu-item" onclick="abrirModalidade('MTB')"><i class="fas fa-biking"></i><p>MTB</p></div>
                <div class="menu-item" onclick="abrirModalidade('XC / XCO')"><i class="fas fa-tree"></i><p>XC / XCO</p></div>
                <div class="menu-item" onclick="abrirModalidade('Bicicross')"><i class="fas fa-bicycle"></i><p>Bicicross</p></div>
                <div class="menu-item" onclick="abrirModalidade('BMX')"><i class="fas fa-fire"></i><p>BMX</p></div>
                <div class="menu-item" onclick="toggleView('view-partners')"><i class="fas fa-handshake"></i><p>Parceiros</p></div>
                <div class="menu-item" onclick="abrirModalidade('Not√≠cias')"><i class="far fa-newspaper"></i><p>Not√≠cias</p></div>
            </div>
        </div>

        <div id="view-partners" class="view">
            <h3 style="text-align:center;">Parceiros</h3>
            <div class="partner-grid">
                <div class="partner-card"><i class="fas fa-bicycle"></i></div>
                <div class="partner-card"><i class="fas fa-store"></i></div>
                <div class="partner-card"><i class="fas fa-cog"></i></div>
                <div class="partner-card"><i class="fas fa-medal"></i></div>
            </div>
            <div class="link" onclick="toggleView('view-dashboard')">Voltar</div>
        </div>

        <div id="view-category" class="view">
            <div class="dash-header"><div onclick="toggleView('view-dashboard')"><i class="fas fa-arrow-left"></i> <strong style="color:var(--fpc-yellow);" id="cat-title">...</strong></div></div>
            <button class="btn-outline" onclick="abrirCalendario()">Calend√°rio & Inscri√ß√µes</button>
            <button class="btn-outline">Carteirinha Digital</button>
            <button class="btn-outline">Seguro Atleta</button>
            <button class="btn-outline">Ranking</button>
        </div>

        <div id="view-events" class="view">
            <div class="dash-header"><div onclick="toggleView('view-category')"><i class="fas fa-arrow-left"></i> <strong>Etapas 2026</strong></div></div>
            <div id="events-container"></div>
        </div>

        <div id="view-payment" class="view">
            <h3 style="text-align:center;">Pagamento</h3>
            <div style="background:rgba(255,255,255,0.05); padding:15px; border-radius:10px;">
                <p style="font-size:0.8em; color:#aaa;">EVENTO</p><strong id="pay-event-name" style="color:white;"></strong><br><br>
                <p style="font-size:0.8em; color:#aaa;">CATEGORIA</p><strong id="pay-category" style="color:var(--fpc-yellow);"></strong>
                <hr style="border-color:#333;">
                <div style="display:flex; justify-content:space-between;"><strong style="color:white;">TOTAL</strong><strong style="color:var(--fpc-green);">R$ 120,00</strong></div>
            </div>
            <p style="text-align:center; font-size:0.8em; margin-top:20px;">PIX Copia e Cola:</p>
            <input type="text" value="00020126360014BR.GOV.BCB.PIX..." style="width:100%; padding:10px; background:#222; border:1px dashed #555; color:white; text-align:center;" readonly>
            <button onclick="gerarConfirmacao()">CONFIRMAR</button>
            <div class="link" onclick="toggleView('view-events')">Cancelar</div>
        </div>

        <div id="view-ticket" class="view">
            <h3 style="text-align:center;">Sucesso!</h3>
            <div id="ticket-area">
                <img src="logo-fpc.png" style="width:50px; margin-bottom:10px;">
                <div style="border-bottom:1px dashed #555; margin-bottom:10px; padding-bottom:10px;">
                    <strong style="color:var(--fpc-yellow);">COMPROVANTE FPC</strong>
                </div>
                <p id="ticket-name" style="color:white;"></p>
                <p id="ticket-event" style="color:#ccc; font-size:0.9em;"></p>
                <p id="ticket-cat" style="color:var(--fpc-yellow); font-weight:bold;"></p>
                <div style="background:var(--fpc-green); color:white; padding:5px; border-radius:5px; margin-top:10px; font-size:0.8em;">PAGO</div>
            </div>
            <button onclick="downloadComprovante()">BAIXAR IMAGEM</button>
            <div class="link" onclick="toggleView('view-dashboard')">In√≠cio</div>
        </div>

        <div id="view-recover" class="view">
            <h3 style="text-align:center;">Recuperar</h3>
            <div id="rec-step-1">
                <div class="input-group"><label>CPF</label><input type="text" id="rec-cpf" oninput="maskCPF(this)"></div>
                <button onclick="buscarRecuperacao()">Buscar</button>
            </div>
            <div id="rec-step-2" style="display:none;">
                <p id="rec-hint" style="text-align:center; color:var(--fpc-yellow);"></p>
                <div class="input-group"><input type="text" id="rec-ans" placeholder="Sua resposta"></div>
                <button onclick="validarRecuperacao()">Validar</button>
            </div>
            <div class="link" onclick="toggleView('view-login')">Cancelar</div>
        </div>

    </div>

    <script>
        // === PWA INSTALA√á√ÉO ===
        let deferredPrompt;
        window.addEventListener('load', () => {
            // Registra Service Worker
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js');
            }
            // Anima√ß√£o Splash
            setTimeout(() => {
                document.getElementById('splash-screen').style.opacity = '0';
                setTimeout(() => { 
                    document.getElementById('splash-screen').style.display = 'none';
                    document.getElementById('app-content').style.display = 'block';
                }, 500);
            }, 2000);
        });

        // Detecta Android/PC
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('install-btn').style.display = 'block';
        });

        async function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                deferredPrompt = null;
                document.getElementById('install-btn').style.display = 'none';
            }
        }

        // Detecta iOS
        const isIos = /iphone|ipad|ipod/.test(window.navigator.userAgent.toLowerCase());
        if (isIos && !window.navigator.standalone) {
            document.getElementById('ios-btn').style.display = 'block';
        }
        function showIOS() { document.getElementById('ios-modal').style.display = 'flex'; }

        // === L√ìGICA DO APP ===
        const eventos = [
            {id:1, nome:"DH Ouricuri", data:"25/26 Abr"}, 
            {id:2, nome:"Caruaru Downhill", data:"16/17 Mai"},
            {id:3, nome:"Santa Cruz Extreme", data:"29/30 Ago"},
            {id:4, nome:"Gravat√° Race", data:"19/20 Set"}
        ];
        let usuario = null, eventoAtual = null, recUser = null;

        function toggleView(id) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            window.scrollTo(0,0);
        }
        function maskCPF(i){i.value=i.value.replace(/\D/g,"").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d{1,2})$/,"$1-$2");}
        function maskPhone(i){i.value=i.value.replace(/\D/g,"").replace(/^(\d\d)(\d)/,"($1) $2").replace(/(\d)(\d{4})$/,"$1-$2");}
        
        function registrarUsuario() {
            const nome=document.getElementById('reg-name').value, cpf=document.getElementById('reg-cpf').value, pass=document.getElementById('reg-pass').value, sec=document.getElementById('reg-sec').value, birth=document.getElementById('reg-birth').value;
            if(!nome||!cpf||!pass) return alert("Preencha tudo");
            let db = JSON.parse(localStorage.getItem('bikeUsers')) || [];
            db.push({nome,cpf,pass,sec,birth});
            localStorage.setItem('bikeUsers', JSON.stringify(db));
            alert("Sucesso!"); toggleView('view-login');
        }
        function fazerLogin() {
            const cpf=document.getElementById('login-cpf').value, pass=document.getElementById('login-pass').value;
            let db = JSON.parse(localStorage.getItem('bikeUsers')) || [];
            usuario = db.find(u => u.cpf === cpf && u.pass === pass);
            if(usuario) { document.getElementById('user-name-display').innerText = usuario.nome.split(' ')[0]; toggleView('view-dashboard'); }
            else alert("Erro");
        }
        function logout(){ location.reload(); }
        function resetarSistema(){ localStorage.clear(); location.reload(); }

        function abrirModalidade(n) { document.getElementById('cat-title').innerText = n; toggleView('view-category'); }
        function abrirCalendario() {
            const c = document.getElementById('events-container'); c.innerHTML="";
            eventos.forEach(e => c.innerHTML += `<div class="event-card"><h4>${e.nome}</h4><p>${e.data}</p><button onclick="selEvento(${e.id})" style="background:#fdd000;border:none;padding:5px 10px;border-radius:5px;margin-top:5px;">INSCREVER</button></div>`);
            toggleView('view-events');
        }
        function selEvento(id) {
            eventoAtual = eventos.find(e => e.id===id);
            document.getElementById('pay-event-name').innerText = eventoAtual.nome;
            document.getElementById('pay-category').innerText = calcularCat(usuario.birth);
            toggleView('view-payment');
        }
        function calcularCat(d) {
            const idade = new Date().getFullYear() - new Date(d).getFullYear();
            if(idade<=18) return "J√∫nior/Juvenil"; if(idade<=29) return "Sub-30"; return "Master";
        }
        function gerarConfirmacao() {
            document.getElementById('ticket-name').innerText = usuario.nome;
            document.getElementById('ticket-event').innerText = eventoAtual.nome;
            document.getElementById('ticket-cat').innerText = calcularCat(usuario.birth);
            toggleView('view-ticket');
        }
        function downloadComprovante() {
            html2canvas(document.getElementById('ticket-area')).then(c => {
                const a = document.createElement('a'); a.download='ticket.png'; a.href=c.toDataURL(); a.click();
            });
        }
        
        function buscarRecuperacao() {
            const cpf=document.getElementById('rec-cpf').value;
            let db=JSON.parse(localStorage.getItem('bikeUsers'))||[];
            recUser=db.find(u=>u.cpf===cpf);
            if(recUser){
                document.getElementById('rec-step-1').style.display='none';
                document.getElementById('rec-step-2').style.display='block';
                document.getElementById('rec-hint').innerText = "Palavra de Seguran√ßa?";
            } else alert("N√£o encontrado");
        }
        function validarRecuperacao() {
            if(document.getElementById('rec-ans').value === recUser.sec) alert("Senha: " + recUser.pass);
            else alert("Erro");
        }
    </script>
</body>
</html>
